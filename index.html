<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Image Color Picker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f7f7f7;
      text-align: center;
    }

    .container {
      max-width: 800px;
      margin: auto;
    }

    canvas {
      border: 1px solid #ccc;
      cursor: crosshair;
      max-width: 100%;
      height: auto;
    }

    #magnifier {
      position: absolute;
      border: 2px solid #000;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      pointer-events: none;
      display: none;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      z-index: 10;
    }

    #colorInfo {
      margin-top: 20px;
      font-size: 18px;
      display: flex;
      justify-content: center;
      gap: 40px;
    }

    .colorBox {
      cursor: pointer;
      padding: 10px 15px;
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .colorSample {
      width: 20px;
      height: 20px;
      border: 1px solid #000;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Image Color Picker</h1>
    <input type="file" id="imageInput" accept="image/*" />
    <div id="canvasWrapper" style="position:relative;">
      <canvas id="imageCanvas"></canvas>
      <div id="magnifier"></div>
    </div>
    <div id="colorInfo">
      <div class="colorBox" id="currentColorBox" title="Click to copy">
        <div class="colorSample" id="currentColorSample"></div>
        <span id="hexColor">#ffffff</span>
      </div>
      <div class="colorBox" id="selectedColorBox" title="Selected Color (Click to copy)">
        <div class="colorSample" id="selectedColorSample"></div>
        <span id="selectedHexColor">#ffffff</span>
      </div>
    </div>
  </div>

  <script>
    const imageInput = document.getElementById("imageInput");
    const imageCanvas = document.getElementById("imageCanvas");
    const ctx = imageCanvas.getContext("2d");
    const magnifier = document.getElementById("magnifier");
    const hexColor = document.getElementById("hexColor");
    const selectedHexColor = document.getElementById("selectedHexColor");
    const currentColorSample = document.getElementById("currentColorSample");
    const selectedColorSample = document.getElementById("selectedColorSample");
    const currentColorBox = document.getElementById("currentColorBox");
    const selectedColorBox = document.getElementById("selectedColorBox");

    let img = new Image();

    imageInput.addEventListener("change", (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        img.onload = () => {
          imageCanvas.width = img.width;
          imageCanvas.height = img.height;
          ctx.drawImage(img, 0, 0);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    });

    imageCanvas.addEventListener("mousemove", (e) => {
      const rect = imageCanvas.getBoundingClientRect();
      const scaleX = imageCanvas.width / rect.width;
      const scaleY = imageCanvas.height / rect.height;
      const x = Math.floor((e.clientX - rect.left) * scaleX);
      const y = Math.floor((e.clientY - rect.top) * scaleY);

      const pixel = ctx.getImageData(x, y, 1, 1).data;
      const hex = rgbToHex(pixel[0], pixel[1], pixel[2]);
      hexColor.textContent = hex;
      currentColorSample.style.backgroundColor = hex;

      magnifier.style.left = e.pageX - 50 + "px";
      magnifier.style.top = e.pageY - 50 + "px";
      magnifier.style.display = "block";

      drawMagnifier(x, y);
    });

    imageCanvas.addEventListener("click", () => {
      selectedHexColor.textContent = hexColor.textContent;
      selectedColorSample.style.backgroundColor = hexColor.textContent;
    });

    imageCanvas.addEventListener("mouseleave", () => {
      magnifier.style.display = "none";
    });

    currentColorBox.addEventListener("click", () => copyToClipboard(hexColor.textContent));
    selectedColorBox.addEventListener("click", () => copyToClipboard(selectedHexColor.textContent));

    function drawMagnifier(x, y) {
      const zoom = 6;
      const size = 25;
      const magnifierCanvas = document.createElement("canvas");
      magnifierCanvas.width = 100;
      magnifierCanvas.height = 100;
      const mCtx = magnifierCanvas.getContext("2d");

      mCtx.imageSmoothingEnabled = false;
      mCtx.drawImage(
        imageCanvas,
        x - size / 2,
        y - size / 2,
        size,
        size,
        0,
        0,
        100,
        100
      );

      mCtx.beginPath();
      mCtx.strokeStyle = "red";
      mCtx.lineWidth = 1;
      mCtx.moveTo(50, 45);
      mCtx.lineTo(50, 55);
      mCtx.moveTo(45, 50);
      mCtx.lineTo(55, 50);
      mCtx.stroke();

      magnifier.style.background = `url(${magnifierCanvas.toDataURL()})`;
      magnifier.style.backgroundSize = "100px 100px";
    }

    function rgbToHex(r, g, b) {
      return (
        "#" +
        [r, g, b]
          .map((x) => {
            const hex = x.toString(16);
            return hex.length === 1 ? "0" + hex : hex;
          })
          .join("")
      );
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        const toast = document.createElement("div");
        toast.textContent = `Copied ${text} to clipboard!`;
        toast.style.position = "fixed";
        toast.style.bottom = "20px";
        toast.style.left = "50%";
        toast.style.transform = "translateX(-50%)";
        toast.style.backgroundColor = "#333";
        toast.style.color = "#fff";
        toast.style.padding = "10px 20px";
        toast.style.borderRadius = "5px";
        toast.style.zIndex = "1000";
        toast.style.opacity = "0";
        toast.style.transition = "opacity 0.3s ease";

        document.body.appendChild(toast);
        requestAnimationFrame(() => {
          toast.style.opacity = "1";
        });

        setTimeout(() => {
          toast.style.opacity = "0";
          setTimeout(() => document.body.removeChild(toast), 300);
        }, 1500);
      });
    }
  </script>
</body>
</html>
